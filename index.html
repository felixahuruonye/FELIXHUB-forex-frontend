<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Forex Timezone Pro ‚Äî FelixHub</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{--primary:#0ea5e9;--muted:#64748b;--card-bg:#fff}
    body{font-family:Inter,system-ui,Arial;background:#f3f4f6;padding:18px;color:#0f172a;margin:0}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:18px;gap:8px}
    header h1{margin:0;font-size:20px}
    header .subtitle{color:var(--muted);font-size:13px}
    .card{background:var(--card-bg);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.06);margin-bottom:12px}
    input, select, button{padding:10px;border-radius:8px;border:1px solid #e6e7ea;font-size:15px}
    .row{display:flex;gap:10px;align-items:center}
    .row .col{flex:1}
    .row .small-col{width:110px}
    .results{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:12px}
    .time-card{background:linear-gradient(180deg,#fff,#fbfdff);padding:12px;border-radius:10px;border:1px solid #e6eef8}
    .button-primary{background:var(--primary);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    .button-secondary{background:#eef2f7;color:#0f172a;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
    .add-row-btn{display:block;width:100%;padding:12px;border-radius:10px;background:var(--primary);color:#fff;border:none;margin-top:10px}
    .removeBtn{background:#fde68a;border:none;padding:8px;border-radius:8px;cursor:pointer}
    .small{font-size:13px;color:var(--muted)}
    @media(max-width:520px){.row{flex-direction:column;align-items:stretch}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üåç FELIXHUB WorldTimezone Pro</h1>
      <div class="subtitle">Free trial: 10 searches + 1 IP lookup, then subscribe for full access.</div>
    </header>

    <div class="card">
      <div id="multiContainer"></div>
      <button id="addBtn" class="add-row-btn">+ Add a country / city</button>
      <div class="row" style="margin-top:12px">
        <button id="sendBtn" class="button-primary" style="flex:1">Get Times</button>
        <button id="ipBtn" class="button-secondary" style="width:160px;margin-left:0">Use My IP</button>
      </div>
      <div class="small" style="margin-top:10px;">Searches left: <span id="searchLeft">10</span> ‚Ä¢ IP Trial left: <span id="trialLeft">1</span></div>
    </div>

    <div id="results" class="results"></div>

    <div class="card">
      <h3>Upgrade to Premium</h3>
      <p class="small">Unlock more continents, IP tools, postal codes, 100+ cities, and forex tools.</p>
      <a href="https://paystack.shop/pay/felixhub-premium" target="_blank">
        <button class="button-primary">Subscribe on Paystack</button>
      </a>
    </div>

    <footer style="margin-top:18px;text-align:center;color:#94a3b8;">¬© 2025 FelixHub</footer>
  </div>

<script>
const BACKEND = "https://felixhub-forex-backend.onrender.com";
const FREE_LIMIT = 10;
const IP_TRIAL_LIMIT = 1;

const multiContainer = document.getElementById('multiContainer');
const addBtn = document.getElementById('addBtn');
const sendBtn = document.getElementById('sendBtn');
const ipBtn = document.getElementById('ipBtn');
const results = document.getElementById('results');
const searchLeftEl = document.getElementById('searchLeft');
const trialLeftEl = document.getElementById('trialLeft');

let searches = 0;
let ipTrials = 0;

function makeRow() {
  const row = document.createElement('div');
  row.className = 'row';
  row.innerHTML = `
    <div class="col"><input class="country" placeholder="Country (e.g. Nigeria / USA)"></div>
    <div class="col"><input class="city" placeholder="City (e.g. Owerri / New York)"></div>
    <div class="small-col"><button class="removeBtn">Remove</button></div>
  `;
  row.querySelector('.removeBtn').onclick = () => row.remove();
  return row;
}

function ensureOneRow() {
  if (!multiContainer.children.length) multiContainer.appendChild(makeRow());
}
function updateCounts() {
  searchLeftEl.textContent = FREE_LIMIT - searches;
  trialLeftEl.textContent = IP_TRIAL_LIMIT - ipTrials;
}

addBtn.onclick = () => multiContainer.appendChild(makeRow());
ensureOneRow();
updateCounts();

function addCard(title, tz, dt, extra) {
  const div = document.createElement('div');
  div.className = 'time-card';
  div.innerHTML = `<b>${title}</b><br>${tz}<br>${new Date(dt).toLocaleString()}<br><span class='small'>${extra||''}</span>`;
  results.prepend(div);
}

// Get Time by city/country
sendBtn.onclick = async () => {
  const rows = Array.from(document.querySelectorAll('.row'));
  const queries = rows.map(r => {
    const country = r.querySelector('.country').value.trim();
    const city = r.querySelector('.city').value.trim();
    return city ? `${city}, ${country}` : country;
  }).filter(Boolean);

  if (!queries.length) return alert('Please enter a city or country.');

  if (searches >= FREE_LIMIT) return alert('Free limit reached. Please subscribe.');

  for (const q of queries) {
    try {
      const url = `https://worldtimeapi.org/api/timezone`;
      const resp = await fetch(url);
      const zones = await resp.json();

      const match = zones.find(z => z.toLowerCase().includes(q.split(',')[0].toLowerCase()));
      if (!match) { addCard(q, "Not found", new Date(), "Try a specific city."); continue; }

      const timeRes = await fetch(`https://worldtimeapi.org/api/timezone/${match}`);
      const t = await timeRes.json();
      addCard(q, match, t.datetime, `UTC ${t.utc_offset}`);
    } catch (e) {
      addCard(q, "Error", new Date(), e.message);
    }
  }
  searches++;
  updateCounts();
};

// Use My IP (Premium)
ipBtn.onclick = async () => {
  if (ipTrials >= IP_TRIAL_LIMIT) return alert('Trial used. Subscribe for full IP features.');

  try {
    const res = await fetch(`${BACKEND}/api/ip`);
    const j = await res.json();
    if (!j || !j.data) throw new Error("No IP data");
    const d = j.data;
    const loc = `${d.city || ''}, ${d.country_name || ''}`;
    const tzRes = await fetch(`https://worldtimeapi.org/api/timezone/${d.time_zone || 'Africa/Lagos'}`);
    const tz = await tzRes.json();
    addCard("My IP: " + d.ip, d.time_zone || 'Unknown', tz.datetime, loc);
    ipTrials++;
    updateCounts();
  } catch (e) {
    alert("IP lookup failed: " + e.message);
  }
};
</script>
</body>
</html>
